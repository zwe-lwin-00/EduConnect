<div class="parent-student-learning">
  <a routerLink="/parent" class="back-link">← Back to My Students</a>

  <div *ngIf="loading" class="loading">Loading...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <ng-container *ngIf="overview && !loading && !error">
    <h1 class="page-title">{{ overview.studentName }}</h1>
    <p class="page-desc">Learning overview (read-only). Grade {{ overview.gradeLevel }}. Master Doc 11C C1.</p>
    <div class="hours-left-block" [class.low-hours]="overview.totalRemainingHours < 5 && overview.totalRemainingHours >= 0">
      <strong>{{ overview.totalRemainingHours }} hours left</strong> for {{ overview.studentName }}.
      <span class="top-up-hint" *ngIf="overview.totalRemainingHours < 5 && overview.totalRemainingHours >= 0">Consider topping up with Admin.</span>
    </div>

    <section class="section">
      <h2>Assigned teacher(s)</h2>
      <div *ngIf="overview.assignedTeachers.length === 0" class="empty">No active contract.</div>
      <ul class="list" *ngIf="overview.assignedTeachers.length > 0">
        <li *ngFor="let t of overview.assignedTeachers">
          {{ t.teacherName }} – {{ t.contractIdDisplay }} ({{ t.remainingHours }} hrs remaining)
        </li>
      </ul>
    </section>

    <section class="section">
      <h2>Subjects</h2>
      <p class="value">{{ overview.subjects || '—' }}</p>
    </section>

    <section class="section">
      <h2>Remaining hours</h2>
      <p class="value">{{ overview.totalRemainingHours }} hours</p>
    </section>

    <section class="section">
      <h2>Upcoming sessions (week view)</h2>
      <p class="hint">Sessions this week for {{ overview.studentName }}. Times in Myanmar.</p>
      <div class="week-nav">
        <button type="button" class="btn-nav" (click)="prevWeek()">← Previous</button>
        <span class="week-label">{{ weekLabel }}</span>
        <button type="button" class="btn-nav" (click)="nextWeek()">Next →</button>
        <button type="button" class="btn-this-week" (click)="thisWeek()">This week</button>
      </div>
      <div *ngIf="weekLoading" class="loading-inline">Loading...</div>
      <div *ngIf="!weekLoading" class="week-grid">
        <div *ngFor="let col of dayColumns" class="day-column" [class.today]="col.isToday">
          <div class="day-header">
            <span class="day-name">{{ col.label }}</span>
            <span class="day-date">{{ col.date | date:'d MMM' }}</span>
          </div>
          <div class="day-sessions">
            <div *ngFor="let s of sessionsOnDay(col.date)" class="session-block">
              <div class="session-time">{{ s.startTime }}<span *ngIf="s.endTime"> – {{ s.endTime }}</span></div>
              <div class="session-meta">{{ s.teacherName }} · {{ s.contractIdDisplay }} · {{ s.status }}</div>
            </div>
            <div *ngIf="sessionsOnDay(col.date).length === 0" class="no-sessions">—</div>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <h2>Contracts with remaining hours</h2>
      <p class="hint">Teacher delivers sessions; Admin confirms.</p>
      <div *ngIf="overview.upcomingSessions.length === 0" class="empty">None.</div>
      <ul class="list" *ngIf="overview.upcomingSessions.length > 0">
        <li *ngFor="let u of overview.upcomingSessions">
          {{ u.teacherName }} – {{ u.contractIdDisplay }} ({{ u.remainingHours }} hrs)
        </li>
      </ul>
    </section>

    <section class="section">
      <h2>Completed sessions</h2>
      <p class="hint">Past sessions with lesson notes and progress (read-only).</p>
      <div *ngIf="overview.completedSessions.length === 0" class="empty">No completed sessions yet.</div>
      <div *ngFor="let c of overview.completedSessions" class="session-card">
        <div class="session-header">
          {{ c.teacherName }} · {{ c.checkInTime | date:'short':'+0630' }}
          <span *ngIf="c.checkOutTime"> – {{ c.checkOutTime | date:'short':'+0630' }}</span>
          · {{ c.hoursUsed | number:'1.1-1' }} hrs
        </div>
        <div class="session-notes" *ngIf="c.lessonNotes">
          <strong>Lesson notes:</strong> {{ c.lessonNotes }}
        </div>
        <div class="session-progress" *ngIf="c.progressReport">
          <strong>Progress:</strong> {{ c.progressReport }}
        </div>
      </div>
    </section>

    <section class="section">
      <h2>Homework</h2>
      <p class="hint">Assignments from teachers (read-only).</p>
      <div *ngIf="!overview.homeworks?.length" class="empty">No homework yet.</div>
      <div *ngFor="let h of overview.homeworks || []" class="session-card">
        <div class="session-header">{{ h.title }} · {{ h.teacherName }} · Due {{ h.dueDate | date:'shortDate':'+0630' }} · {{ h.statusText }}</div>
        <div class="session-notes" *ngIf="h.description">{{ h.description }}</div>
        <div class="session-notes" *ngIf="h.teacherFeedback"><strong>Teacher feedback:</strong> {{ h.teacherFeedback }}</div>
      </div>
    </section>

    <section class="section">
      <h2>Grades</h2>
      <p class="hint">Grades and assessments from teachers (read-only).</p>
      <div *ngIf="!overview.grades?.length" class="empty">No grades yet.</div>
      <div *ngFor="let g of overview.grades || []" class="session-card">
        <div class="session-header">{{ g.title }} · {{ g.teacherName }} · {{ g.gradeValue }}{{ g.maxValue != null ? ' / ' + g.maxValue : '' }} · {{ g.gradeDate | date:'shortDate':'+0630' }}</div>
        <div class="session-notes" *ngIf="g.notes">{{ g.notes }}</div>
      </div>
    </section>
  </ng-container>
</div>
