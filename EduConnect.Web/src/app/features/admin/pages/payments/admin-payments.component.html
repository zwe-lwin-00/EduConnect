<div class="admin-payments">
  <div class="page-header-compact">
    <div>
      <h1>Subscriptions</h1>
      <p class="page-desc-short">Renew monthly subscriptions (1st–last day of each month). Freeze student on Students page.</p>
    </div>
    <div class="flex gap-2">
      <p-button label="Renew subscription" icon="pi pi-calendar-plus" severity="success" (onClick)="openRenewPopup()" />
    </div>
  </div>

  <div class="card table-card">
    <p-table
      [value]="students"
      [loading]="loading"
      [tableStyle]="{ 'min-width': '50rem' }"
      styleClass="p-datatable-gridlines p-datatable-striped"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25]"
      [showCurrentPageReport]="true">
      <ng-template pTemplate="header">
        <tr>
          <th style="width:3rem">#</th>
          <th>First name</th>
          <th>Last name</th>
          <th>Parent</th>
          <th>Grade</th>
          <th>Active</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-s let-rowIndex="rowIndex">
        <tr>
          <td>{{ rowIndex + 1 }}</td>
          <td>{{ s.firstName }}</td>
          <td>{{ s.lastName }}</td>
          <td>{{ s.parentName }}</td>
          <td>{{ s.gradeLevelName }}</td>
          <td>{{ s.isActive ? 'Yes' : 'No' }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">
            <div class="empty-table-message">
              <i class="pi pi-users empty-icon"></i>
              <p>No students.</p>
              <p class="empty-hint">Add students from the Students page; then renew subscriptions here.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-dialog header="Renew subscription" [(visible)]="showRenewPopup" [modal]="true" [style]="{ width: '28rem' }" [draggable]="false" (onHide)="closeRenewPopup()">
    <form [formGroup]="renewForm" (ngSubmit)="onSubmitRenew()" class="dialog-form">
      <div class="field"><label>One-To-One class</label><select formControlName="contractId" class="p-inputtext w-full"><option [ngValue]="null">Select One-To-One class</option><option *ngFor="let c of contracts" [ngValue]="c.id">{{ contractLabel(c) }} – {{ c.studentName }}</option></select></div>
    </form>
    <ng-template pTemplate="footer">
      <p-button label="Cancel" severity="secondary" (onClick)="closeRenewPopup()" />
      <p-button label="Renew 1 month" icon="pi pi-calendar-plus" (onClick)="onSubmitRenew()" [disabled]="!renewForm.valid" />
    </ng-template>
  </p-dialog>
</div>
