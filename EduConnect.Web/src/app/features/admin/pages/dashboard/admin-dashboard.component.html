<div class="admin-dashboard">
  <div class="dashboard-header">
    <h1>Admin Dashboard</h1>
    <dx-button
      text="Onboard New Teacher"
      type="success"
      (onClick)="openOnboardPopup()"
      [icon]="'plus'">
    </dx-button>
  </div>

  <dx-tab-panel [height]="600">
    <dxi-item title="Teachers" icon="user">
      <dx-data-grid
        [dataSource]="teachers"
        [allowColumnReordering]="true"
        [allowColumnResizing]="true"
        [columnAutoWidth]="true"
        [showBorders]="true">
        <dxi-column dataField="firstName" caption="First Name"></dxi-column>
        <dxi-column dataField="lastName" caption="Last Name"></dxi-column>
        <dxi-column dataField="email" caption="Email"></dxi-column>
        <dxi-column dataField="phoneNumber" caption="Phone"></dxi-column>
        <dxi-column dataField="educationLevel" caption="Education"></dxi-column>
        <dxi-column dataField="hourlyRate" caption="Hourly Rate" dataType="number" format="currency"></dxi-column>
        <dxi-column
          dataField="verificationStatus"
          caption="Status"
          [cellTemplate]="'statusCellTemplate'">
        </dxi-column>
        <dxi-column
          caption="Actions"
          [cellTemplate]="'teacherActionsTemplate'"
          [allowSorting]="false"
          [width]="200">
        </dxi-column>
        <div *dxTemplate="let data of 'statusCellTemplate'">
          <span [class]="getVerificationStatusClass(data.data.verificationStatus)">
            {{ getVerificationStatusText(data.data.verificationStatus) }}
          </span>
        </div>
        <div *dxTemplate="let data of 'teacherActionsTemplate'">
          <dx-button
            text="View"
            type="normal"
            stylingMode="outlined"
            (onClick)="onViewTeacherDetails(data.data)"
            [icon]="'eyeopen'">
          </dx-button>
          <dx-button
            *ngIf="data.data.verificationStatus === 1"
            text="Verify"
            type="success"
            stylingMode="outlined"
            (onClick)="onVerifyTeacher(data.data)"
            [icon]="'check'">
          </dx-button>
          <dx-button
            *ngIf="data.data.verificationStatus === 1"
            text="Reject"
            type="danger"
            stylingMode="outlined"
            (onClick)="onRejectTeacher(data.data)"
            [icon]="'close'">
          </dx-button>
        </div>
      </dx-data-grid>
    </dxi-item>

    <dxi-item title="Parents" icon="group">
      <dx-data-grid
        [dataSource]="parents"
        [allowColumnReordering]="true"
        [allowColumnResizing]="true"
        [columnAutoWidth]="true"
        [showBorders]="true">
        <dxi-column dataField="firstName" caption="First Name"></dxi-column>
        <dxi-column dataField="lastName" caption="Last Name"></dxi-column>
        <dxi-column dataField="email" caption="Email"></dxi-column>
        <dxi-column dataField="phoneNumber" caption="Phone"></dxi-column>
        <dxi-column dataField="studentCount" caption="Students" dataType="number"></dxi-column>
        <dxi-column dataField="createdAt" caption="Created" dataType="date" format="shortDate"></dxi-column>
      </dx-data-grid>
    </dxi-item>

    <dxi-item title="Students" icon="card">
      <dx-data-grid
        [dataSource]="students"
        [allowColumnReordering]="true"
        [allowColumnResizing]="true"
        [columnAutoWidth]="true"
        [showBorders]="true">
        <dxi-column dataField="firstName" caption="First Name"></dxi-column>
        <dxi-column dataField="lastName" caption="Last Name"></dxi-column>
        <dxi-column dataField="parentName" caption="Parent"></dxi-column>
        <dxi-column dataField="gradeLevelName" caption="Grade"></dxi-column>
        <dxi-column dataField="walletBalance" caption="Wallet Balance" dataType="number"></dxi-column>
        <dxi-column dataField="dateOfBirth" caption="Date of Birth" dataType="date" format="shortDate"></dxi-column>
      </dx-data-grid>
    </dxi-item>
  </dx-tab-panel>

  <!-- Onboard Teacher Popup -->
  <dx-popup
    [(visible)]="showOnboardPopup"
    [showTitle]="true"
    title="Onboard New Teacher"
    [width]="600"
    [height]="600"
    [showCloseButton]="true"
    (onHiding)="closeOnboardPopup()">
    <div *dxTemplate="let data of 'content'">
      <form [formGroup]="onboardForm" (ngSubmit)="onSubmitOnboard()" class="onboard-form">
        <div class="form-group">
          <label>Email *</label>
          <input type="email" formControlName="email" class="form-control" />
          <div class="error" *ngIf="onboardForm.get('email')?.invalid && onboardForm.get('email')?.touched">
            Valid email is required
          </div>
        </div>
        <div class="form-group">
          <label>First Name *</label>
          <input type="text" formControlName="firstName" class="form-control" />
        </div>
        <div class="form-group">
          <label>Last Name *</label>
          <input type="text" formControlName="lastName" class="form-control" />
        </div>
        <div class="form-group">
          <label>Phone Number *</label>
          <input type="text" formControlName="phoneNumber" class="form-control" />
        </div>
        <div class="form-group">
          <label>NRC Number *</label>
          <input type="text" formControlName="nrcNumber" class="form-control" />
        </div>
        <div class="form-group">
          <label>Education Level *</label>
          <input type="text" formControlName="educationLevel" class="form-control" />
        </div>
        <div class="form-group">
          <label>Hourly Rate *</label>
          <input type="number" formControlName="hourlyRate" class="form-control" min="0" />
        </div>
        <div class="form-group">
          <label>Bio</label>
          <textarea formControlName="bio" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>Specializations</label>
          <input type="text" formControlName="specializations" class="form-control" />
        </div>
        <div class="form-actions">
          <dx-button text="Cancel" type="normal" (onClick)="closeOnboardPopup()"></dx-button>
          <dx-button text="Onboard" type="success" (onClick)="onSubmitOnboard()" [disabled]="!onboardForm.valid"></dx-button>
        </div>
      </form>
    </div>
  </dx-popup>

  <!-- Teacher Details Popup -->
  <dx-popup
    [(visible)]="showTeacherDetails"
    [showTitle]="true"
    [title]="selectedTeacher ? selectedTeacher.firstName + ' ' + selectedTeacher.lastName : 'Teacher Details'"
    [width]="700"
    [height]="600"
    [showCloseButton]="true"
    (onHiding)="closeTeacherDetails()">
    <div *dxTemplate="let data of 'content'">
      <ng-container *ngIf="selectedTeacher">
      <div class="teacher-details">
        <div class="detail-row">
          <strong>Email:</strong> {{ selectedTeacher.email }}
        </div>
        <div class="detail-row">
          <strong>Phone:</strong> {{ selectedTeacher.phoneNumber }}
        </div>
        <div class="detail-row">
          <strong>Education Level:</strong> {{ selectedTeacher.educationLevel }}
        </div>
        <div class="detail-row">
          <strong>Hourly Rate:</strong> {{ selectedTeacher.hourlyRate | currency }}
        </div>
        <div class="detail-row">
          <strong>Status:</strong>
          <span [class]="getVerificationStatusClass(selectedTeacher.verificationStatus)">
            {{ getVerificationStatusText(selectedTeacher.verificationStatus) }}
          </span>
        </div>
        <div class="detail-row" *ngIf="selectedTeacher.bio">
          <strong>Bio:</strong>
          <p>{{ selectedTeacher.bio }}</p>
        </div>
        <div class="detail-row" *ngIf="selectedTeacher.specializations">
          <strong>Specializations:</strong> {{ selectedTeacher.specializations }}
        </div>
        <div class="detail-row">
          <strong>Created:</strong> {{ selectedTeacher.createdAt | date:'short' }}
        </div>
        <div class="detail-row" *ngIf="selectedTeacher.verifiedAt">
          <strong>Verified:</strong> {{ selectedTeacher.verifiedAt | date:'short' }}
        </div>
      </div>
      </ng-container>
    </div>
  </dx-popup>
</div>
