<div class="admin-reports page-container">
  <div class="page-header-compact">
    <div>
      <h1>Reports &amp; Audit</h1>
      <p class="page-desc-short">Daily: sessions delivered, hours consumed. Monthly: revenue, teacher utilization.</p>
    </div>
  </div>

  <p-card header="Daily Report" styleClass="report-card-block">
    <div class="report-controls">
      <label>Date</label>
      <p-calendar appendTo="body" [(ngModel)]="dailyDateModel" (ngModelChange)="onDailyDateChange()" dateFormat="yy-mm-dd" placeholder="Select date" styleClass="report-input" />
    </div>
    <div *ngIf="loadingDaily" class="empty-table-message">
      <p-progressSpinner strokeWidth="4" styleClass="mb-2" />
      <p>Loading...</p>
    </div>
    <div *ngIf="dailyReport && !loadingDaily" class="report-summary">
      <div class="report-row"><span class="label">Sessions delivered</span><span class="value">{{ dailyReport.sessionsDelivered }}</span></div>
      <div class="report-row"><span class="label">Hours consumed</span><span class="value">{{ dailyReport.hoursConsumed | number:'1.1-1' }}</span></div>
    </div>
  </p-card>

  <p-card header="Monthly Report" styleClass="report-card-block">
    <div class="report-controls">
      <label>Year</label>
      <p-inputNumber [(ngModel)]="reportYear" (ngModelChange)="loadMonthly()" [min]="2020" [max]="2030" inputStyleClass="report-input year-input" styleClass="report-input" />
      <label>Month</label>
      <p-dropdown appendTo="body" [(ngModel)]="reportMonth" [options]="monthOptions" optionLabel="label" optionValue="value" (ngModelChange)="loadMonthly()" styleClass="report-select" [style]="{ minWidth: '8rem' }" />
    </div>
    <div *ngIf="loadingMonthly" class="empty-table-message">
      <p-progressSpinner strokeWidth="4" styleClass="mb-2" />
      <p>Loading...</p>
    </div>
    <div *ngIf="monthlyReport && !loadingMonthly" class="report-summary">
      <div class="report-row"><span class="label">Revenue</span><span class="value">{{ monthlyReport.revenue | number:'1.0-0' }} MMK</span></div>
      <div class="report-row"><span class="label">Sessions delivered</span><span class="value">{{ monthlyReport.sessionsDelivered }}</span></div>
      <div class="report-row"><span class="label">Hours consumed</span><span class="value">{{ monthlyReport.hoursConsumed | number:'1.1-1' }}</span></div>
    </div>
    <div *ngIf="monthlyReport && !loadingMonthly && monthlyReport.teacherUtilization?.length" class="mt-4">
      <h3 class="section-title">Teacher utilization</h3>
      <p-table [value]="monthlyReport.teacherUtilization" [tableStyle]="{ 'min-width': '20rem' }" styleClass="p-datatable-gridlines p-datatable-striped">
        <ng-template pTemplate="header">
          <tr><th>Teacher</th><th>Hours</th><th>Sessions</th></tr>
        </ng-template>
        <ng-template pTemplate="body" let-t>
          <tr>
            <td>{{ t.teacherName }}</td>
            <td>{{ t.hoursDelivered | number:'1.1-1' }}</td>
            <td>{{ t.sessionsCount }}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr><td colspan="3">No utilization data.</td></tr>
        </ng-template>
      </p-table>
    </div>
  </p-card>
</div>
