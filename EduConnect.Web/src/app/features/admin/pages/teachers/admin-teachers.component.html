<div class="admin-teachers">
  <div class="page-header-compact">
    <div>
      <h1>Teachers</h1>
      <p class="page-desc-short">Onboard, verify, edit, and manage teacher accounts.</p>
    </div>
    <p-button label="Onboard teacher" icon="pi pi-plus" severity="success" (onClick)="openOnboardPopup()" />
  </div>

  <div class="card table-card">
    <p-table
      [value]="teachers"
      [tableStyle]="{ 'min-width': '56rem' }"
      styleClass="p-datatable-gridlines p-datatable-striped"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [showCurrentPageReport]="true">
      <ng-template pTemplate="header">
        <tr>
          <th style="width:3rem">#</th>
          <th>First name</th>
          <th>Last name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Education</th>
          <th>Rate</th>
          <th>Status</th>
          <th>Active</th>
          <th style="width:14rem">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-t let-rowIndex="rowIndex">
        <tr>
          <td>{{ rowIndex + 1 }}</td>
          <td>{{ t.firstName }}</td>
          <td>{{ t.lastName }}</td>
          <td>{{ t.email }}</td>
          <td>{{ t.phoneNumber }}</td>
          <td>{{ t.educationLevel }}</td>
          <td>{{ t.hourlyRate | currency }}</td>
          <td><p-tag [value]="getVerificationStatusText(t.verificationStatus)" [severity]="getVerificationSeverity(t.verificationStatus)" /></td>
          <td>{{ t.isActive ? 'Yes' : 'No' }}</td>
          <td>
            <div class="action-buttons">
              <p-button icon="pi pi-eye" [outlined]="true" size="small" (onClick)="onViewTeacherDetails(t)" title="View" />
              <p-button icon="pi pi-pencil" [outlined]="true" size="small" (onClick)="openEditPopup(t)" title="Edit" />
              <p-button icon="pi pi-key" [outlined]="true" size="small" (onClick)="onResetTeacherPassword(t)" title="Reset password" />
              <p-button *ngIf="t.verificationStatus === 1" icon="pi pi-check" label="Verify" severity="success" [outlined]="true" size="small" (onClick)="onVerifyTeacher(t)" />
              <p-button *ngIf="t.verificationStatus === 1" icon="pi pi-times" label="Reject" severity="danger" [outlined]="true" size="small" (onClick)="onRejectTeacher(t)" />
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="10">No teachers.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-dialog header="Onboard new teacher" [(visible)]="showOnboardPopup" [modal]="true" [style]="{ width: '32rem' }" [draggable]="false" (onHide)="closeOnboardPopup()">
    <form [formGroup]="onboardForm" (ngSubmit)="onSubmitOnboard()" class="dialog-form">
      <div class="field"><label>Email</label><input pInputText type="email" formControlName="email" class="w-full" /></div>
      <div class="field"><label>First name</label><input pInputText type="text" formControlName="firstName" class="w-full" /></div>
      <div class="field"><label>Last name</label><input pInputText type="text" formControlName="lastName" class="w-full" /></div>
      <div class="field"><label>Phone</label><input pInputText type="text" formControlName="phoneNumber" class="w-full" /></div>
      <div class="field"><label>NRC</label><input pInputText type="text" formControlName="nrcNumber" class="w-full" /></div>
      <div class="field"><label>Education</label><input pInputText type="text" formControlName="educationLevel" class="w-full" /></div>
      <div class="field"><label>Hourly rate</label><input pInputText type="number" formControlName="hourlyRate" class="w-full" min="0" /></div>
      <div class="field"><label>Bio</label><textarea pInputText formControlName="bio" class="w-full" rows="3"></textarea></div>
      <div class="field"><label>Specializations</label><input pInputText type="text" formControlName="specializations" class="w-full" /></div>
    </form>
    <ng-template pTemplate="footer">
      <p-button label="Cancel" severity="secondary" (onClick)="closeOnboardPopup()" />
      <p-button label="Onboard" icon="pi pi-check" (onClick)="onSubmitOnboard()" [disabled]="!onboardForm.valid" />
    </ng-template>
  </p-dialog>

  <p-dialog header="Share credentials" [(visible)]="showCredentialsPopup" [modal]="true" [style]="{ width: '28rem' }" [draggable]="false" (onHide)="closeCredentialsPopup()">
    <p class="mb-4">{{ credentialsNote }}</p>
    <div class="field"><label>Email</label><input pInputText type="text" [value]="credentialsEmail" readonly class="w-full" #emailInput (click)="emailInput.select()" /></div>
    <div class="field"><label>Temporary password</label><input pInputText type="text" [value]="credentialsPassword" readonly class="w-full" #pwdInput (click)="pwdInput.select()" /></div>
    <div class="flex gap-2 mt-4">
      <p-button label="Copy" icon="pi pi-copy" (onClick)="copyCredentialsToClipboard()" />
      <span *ngIf="copyFeedback" class="text-sm">{{ copyFeedback }}</span>
    </div>
    <ng-template pTemplate="footer">
      <p-button label="Done" (onClick)="closeCredentialsPopup()" />
    </ng-template>
  </p-dialog>

  <p-dialog header="Edit teacher" [(visible)]="showEditPopup" [modal]="true" [style]="{ width: '32rem' }" [draggable]="false" (onHide)="closeEditPopup()">
    <form [formGroup]="editForm" (ngSubmit)="onSubmitEdit()" class="dialog-form">
      <div class="field"><label>First name</label><input pInputText type="text" formControlName="firstName" class="w-full" /></div>
      <div class="field"><label>Last name</label><input pInputText type="text" formControlName="lastName" class="w-full" /></div>
      <div class="field"><label>Phone</label><input pInputText type="text" formControlName="phoneNumber" class="w-full" /></div>
      <div class="field"><label>Education</label><input pInputText type="text" formControlName="educationLevel" class="w-full" /></div>
      <div class="field"><label>Hourly rate</label><input pInputText type="number" formControlName="hourlyRate" class="w-full" min="0" /></div>
      <div class="field"><label>Bio</label><textarea pInputText formControlName="bio" class="w-full" rows="3"></textarea></div>
      <div class="field"><label>Specializations</label><input pInputText type="text" formControlName="specializations" class="w-full" /></div>
    </form>
    <ng-template pTemplate="footer">
      <p-button label="Cancel" severity="secondary" (onClick)="closeEditPopup()" />
      <p-button label="Save" icon="pi pi-check" (onClick)="onSubmitEdit()" [disabled]="!editForm.valid" />
    </ng-template>
  </p-dialog>

  <p-dialog [header]="selectedTeacher ? selectedTeacher.firstName + ' ' + selectedTeacher.lastName : 'Teacher'" [(visible)]="showTeacherDetails" [modal]="true" [style]="{ width: '32rem' }" [draggable]="false" (onHide)="closeTeacherDetails()">
    <ng-container *ngIf="selectedTeacher">
      <div class="detail-panel">
        <div class="detail-row"><strong>Email:</strong> {{ selectedTeacher.email }}</div>
        <div class="detail-row"><strong>Phone:</strong> {{ selectedTeacher.phoneNumber }}</div>
        <div class="detail-row"><strong>Education:</strong> {{ selectedTeacher.educationLevel }}</div>
        <div class="detail-row"><strong>Rate:</strong> {{ selectedTeacher.hourlyRate | currency }}</div>
        <div class="detail-row"><strong>Status:</strong> <p-tag [value]="getVerificationStatusText(selectedTeacher.verificationStatus)" [severity]="getVerificationSeverity(selectedTeacher.verificationStatus)" /></div>
        <div class="detail-row"><strong>Active:</strong> {{ selectedTeacher.isActive ? 'Yes' : 'No' }}</div>
        <div class="detail-row" *ngIf="selectedTeacher.bio"><strong>Bio:</strong><p>{{ selectedTeacher.bio }}</p></div>
        <div class="detail-row" *ngIf="selectedTeacher.specializations"><strong>Specializations:</strong> {{ selectedTeacher.specializations }}</div>
      </div>
      <div class="flex gap-2 flex-wrap mt-4">
        <p-button label="Edit" icon="pi pi-pencil" [outlined]="true" (onClick)="openEditPopup(selectedTeacher); showTeacherDetails = false" />
        <p-button label="Reset password" icon="pi pi-key" [outlined]="true" (onClick)="onResetTeacherPassword(selectedTeacher)" />
        <p-button *ngIf="selectedTeacher.isActive" label="Suspend" severity="danger" [outlined]="true" (onClick)="onSetTeacherActive(selectedTeacher, false)" />
        <p-button *ngIf="!selectedTeacher.isActive" label="Activate" severity="success" [outlined]="true" (onClick)="onSetTeacherActive(selectedTeacher, true)" />
      </div>
    </ng-container>
    <ng-template pTemplate="footer">
      <p-button label="Close" (onClick)="closeTeacherDetails()" />
    </ng-template>
  </p-dialog>
</div>
