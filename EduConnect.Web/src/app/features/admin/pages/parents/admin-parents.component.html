<div class="admin-parents">
  <div class="page-header">
    <h1>Parent & Student Management</h1>
    <dx-button text="Create Parent" type="success" (onClick)="openCreatePopup()" [icon]="'plus'"></dx-button>
  </div>

  <dx-data-grid
    [dataSource]="parents"
    [allowColumnReordering]="true"
    [allowColumnResizing]="true"
    [columnAutoWidth]="true"
    [showBorders]="true">
    <dxi-column caption="#" [cellTemplate]="'rowNumberTemplate'" [allowSorting]="false" [allowFiltering]="false" [width]="56"></dxi-column>
    <dxi-column dataField="firstName" caption="First Name"></dxi-column>
    <dxi-column dataField="lastName" caption="Last Name"></dxi-column>
    <dxi-column dataField="email" caption="Email"></dxi-column>
    <dxi-column dataField="phoneNumber" caption="Phone"></dxi-column>
    <dxi-column dataField="studentCount" caption="Students" dataType="number"></dxi-column>
    <dxi-column dataField="createdAt" caption="Created" dataType="date" format="shortDate"></dxi-column>
    <dxi-column dataField="isActive" caption="Active" dataType="boolean"></dxi-column>
    <div *dxTemplate="let data of 'rowNumberTemplate'">{{ (data.rowIndex ?? data.displayIndex ?? 0) + 1 }}</div>
  </dx-data-grid>

  <dx-popup
    [(visible)]="showCreatePopup"
    [showTitle]="true"
    title="Create Parent"
    [width]="500"
    [showCloseButton]="true"
    (onHiding)="closeCreatePopup()">
    <div *dxTemplate="let data of 'content'">
      <form [formGroup]="createForm" (ngSubmit)="onSubmitCreate()" class="form-panel">
        <div class="form-group"><label>Email *</label><input type="email" formControlName="email" class="form-control" /></div>
        <div class="form-group"><label>First Name *</label><input type="text" formControlName="firstName" class="form-control" /></div>
        <div class="form-group"><label>Last Name *</label><input type="text" formControlName="lastName" class="form-control" /></div>
        <div class="form-group"><label>Phone *</label><input type="text" formControlName="phoneNumber" class="form-control" /></div>
        <div class="form-actions">
          <dx-button text="Cancel" type="normal" (onClick)="closeCreatePopup()"></dx-button>
          <dx-button text="Create" type="success" (onClick)="onSubmitCreate()" [disabled]="!createForm.valid"></dx-button>
        </div>
      </form>
    </div>
  </dx-popup>

  <dx-popup
    [(visible)]="showCredentialsPopup"
    [showTitle]="true"
    title="Parent account created â€“ share credentials"
    [width]="500"
    [showCloseButton]="true"
    (onHiding)="closeCredentialsPopup()">
    <div *dxTemplate="let data of 'content'">
      <p class="credentials-note">Share these credentials with the parent so they can log in. They will be required to change the password on first login.</p>
      <div class="form-group">
        <label>Email</label>
        <input type="text" [value]="credentialsEmail" readonly class="form-control credentials-field" #emailInput (click)="emailInput.select()" />
      </div>
      <div class="form-group">
        <label>Temporary password</label>
        <input type="text" [value]="credentialsPassword" readonly class="form-control credentials-field" #pwdInput (click)="pwdInput.select()" />
      </div>
      <div class="credentials-actions">
        <dx-button text="Copy to clipboard" type="success" (onClick)="copyCredentialsToClipboard()" [icon]="'copy'"></dx-button>
        <span class="copy-feedback" *ngIf="copyFeedback">{{ copyFeedback }}</span>
      </div>
      <div class="form-actions" style="margin-top: 1rem;">
        <dx-button text="Done" type="default" (onClick)="closeCredentialsPopup()"></dx-button>
      </div>
    </div>
  </dx-popup>
</div>
