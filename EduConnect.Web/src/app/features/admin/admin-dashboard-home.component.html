<div class="dashboard-home page-container">
  <div class="page-header-compact">
    <div>
      <h1>Dashboard</h1>
      <p class="page-desc-short">Today’s overview and quick links</p>
    </div>
  </div>

  <p-message *ngIf="error" severity="error" [text]="error" styleClass="w-full mb-3" />

  <ng-container *ngIf="loading">
    <div class="dashboard-grid">
      <p-card>
        <p-skeleton width="8rem" height="1.25rem" />
        <p-skeleton width="100%" height="4rem" class="mt-3" />
        <p-skeleton width="100%" height="4rem" class="mt-2" />
      </p-card>
      <p-card>
        <p-skeleton width="8rem" height="1.25rem" />
        <p-skeleton width="100%" height="5rem" class="mt-3" />
      </p-card>
      <p-card>
        <p-skeleton width="8rem" height="1.25rem" />
        <p-skeleton width="6rem" height="3rem" class="mt-3" />
      </p-card>
      <p-card>
        <p-skeleton width="8rem" height="1.25rem" />
        <p-skeleton width="100%" height="3rem" class="mt-3" />
        <p-skeleton width="100%" height="3rem" class="mt-2" />
      </p-card>
    </div>
  </ng-container>

  <ng-container *ngIf="dashboard && !loading">
    <div class="dashboard-grid">
      <p-card header="Alerts">
        <div *ngIf="dashboard.alerts.length === 0" class="empty-state">No alerts</div>
        <div *ngIf="dashboard.alerts.length > 0" class="alert-list">
          <div *ngFor="let a of dashboard.alerts" class="alert-item">
            <p-tag [value]="a.type" [severity]="alertSeverity(a.type)" styleClass="mr-2" />
            <span class="alert-message">{{ a.message }}</span>
          </div>
        </div>
        <p-button routerLink="/admin/attendance" label="View all" icon="pi pi-arrow-right" iconPos="right" [link]="true" styleClass="p-0 mt-2" />
      </p-card>

      <p-card header="Today">
        <div *ngIf="dashboard.todaySessions.length === 0" class="empty-state">No sessions today</div>
        <ul *ngIf="dashboard.todaySessions.length > 0" class="session-list">
          <li *ngFor="let s of dashboard.todaySessions" class="session-item">
            <strong>{{ s.teacherName }}</strong> – {{ s.studentName }}
            <span class="session-meta">{{ s.status }}<span *ngIf="s.checkInTime"> · {{ s.checkInTime | displayDate:'short' }}</span></span>
          </li>
        </ul>
        <p-button routerLink="/admin/attendance" label="Attendance" icon="pi pi-arrow-right" iconPos="right" [link]="true" styleClass="p-0 mt-2" />
      </p-card>

      <p-card header="Pending">
        <div class="stat-value">{{ dashboard.pendingActionsCount }}</div>
        <p class="stat-desc">Need your attention</p>
        <p-button routerLink="/admin/teachers" label="Teachers" icon="pi pi-arrow-right" iconPos="right" [link]="true" styleClass="p-0 mt-2" />
      </p-card>

      <p-card header="This month">
        <div class="data-row">
          <span class="data-label">Revenue</span>
          <span class="data-value">{{ dashboard.revenueSnapshot.revenueThisMonth | number:'1.0-0' }} MMK</span>
        </div>
        <div class="data-row">
          <span class="data-label">Sessions</span>
          <span class="data-value">{{ dashboard.revenueSnapshot.sessionsDeliveredThisMonth }}</span>
        </div>
        <div class="data-row">
          <span class="data-label">Hours</span>
          <span class="data-value">{{ dashboard.revenueSnapshot.hoursConsumedThisMonth | number:'1.1-1' }}</span>
        </div>
        <p-button routerLink="/admin/reports" label="Reports" icon="pi pi-arrow-right" iconPos="right" [link]="true" styleClass="p-0 mt-2" />
      </p-card>
    </div>
  </ng-container>
</div>
