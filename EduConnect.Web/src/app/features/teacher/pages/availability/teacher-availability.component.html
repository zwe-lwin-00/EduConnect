<div class="teacher-availability">
  <div class="page-header-compact">
    <div>
      <h1>Availability Management</h1>
      <p class="page-desc-short">Declare weekly availability only. Availability â‰  booking. Changes may require admin approval if contract exists.</p>
    </div>
  </div>

  <p-message *ngIf="error" severity="error" [text]="error" styleClass="w-full mb-3" />

  <div *ngIf="loading" class="p-4 text-center text-color-secondary"><i class="pi pi-spin pi-spinner mr-2"></i>Loading...</div>

  <p-card *ngIf="!loading" header="Week view">
    <div class="slots-actions mb-3">
      <p-button label="Add slot" icon="pi pi-plus" severity="secondary" (onClick)="addSlot()" />
    </div>
    <p-table [value]="availabilities" [tableStyle]="{ 'min-width': '32rem' }" styleClass="p-datatable-gridlines p-datatable-sm">
      <ng-template pTemplate="header">
        <tr><th>Day</th><th>Start</th><th>End</th><th>Available</th><th style="width:6rem"></th></tr>
      </ng-template>
      <ng-template pTemplate="body" let-a let-rowIndex="rowIndex">
        <tr>
          <td>
            <select [(ngModel)]="a.dayOfWeek" class="p-inputtext p-inputtext-sm w-full">
              <option *ngFor="let d of days" [ngValue]="d.value">{{ d.label }}</option>
            </select>
          </td>
          <td><input pInputText type="time" [(ngModel)]="a.startTime" class="p-inputtext p-inputtext-sm" /></td>
          <td><input pInputText type="time" [(ngModel)]="a.endTime" class="p-inputtext p-inputtext-sm" /></td>
          <td><input type="checkbox" [(ngModel)]="a.isAvailable" /></td>
          <td><p-button icon="pi pi-trash" severity="danger" [text]="true" [rounded]="true" (onClick)="removeSlot(rowIndex)" title="Remove" /></td>
        </tr>
      </ng-template>
    </p-table>
    <div class="mt-3">
      <p-button label="Save availability" icon="pi pi-check" (onClick)="save()" [loading]="saving" />
    </div>
  </p-card>
</div>
