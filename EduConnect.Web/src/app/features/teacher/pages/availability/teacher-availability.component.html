<div class="teacher-availability page-container">
  <div class="page-header-compact">
    <div>
      <h1>Availability Management</h1>
      <p class="page-desc-short">Declare weekly availability only. Availability â‰  booking. Changes may require admin approval if contract exists.</p>
    </div>
  </div>

  <p-message *ngIf="error" severity="error" [text]="error" styleClass="w-full mb-3" />

  <div *ngIf="loading" class="empty-table-message">
    <p-progressSpinner strokeWidth="4" styleClass="mb-2" [style]="{ width: '40px', height: '40px' }" />
    <span class="text-color-secondary">Loading...</span>
  </div>

  <p-card *ngIf="!loading" header="Week view">
    <div class="slots-actions mb-3">
      <p-button label="Add slot" icon="pi pi-plus" severity="secondary" (onClick)="addSlot()" />
    </div>
    <p-table [value]="availabilities" [tableStyle]="{ 'min-width': '32rem' }" styleClass="p-datatable-gridlines p-datatable-sm">
      <ng-template pTemplate="header">
        <tr><th>Day</th><th>Start</th><th>End</th><th>Available</th><th style="width:6rem"></th></tr>
      </ng-template>
      <ng-template pTemplate="body" let-a let-rowIndex="rowIndex">
        <tr>
          <td>
            <p-dropdown appendTo="body" [(ngModel)]="a.dayOfWeek" [options]="days" optionLabel="label" optionValue="value" styleClass="p-inputtext-sm w-full" [style]="{ minWidth: '8rem' }" />
          </td>
          <td><p-calendar appendTo="body" [(ngModel)]="a.startTimeModel" [timeOnly]="true" hourFormat="12" styleClass="p-inputtext-sm" [style]="{ minWidth: '7rem' }" /></td>
          <td><p-calendar appendTo="body" [(ngModel)]="a.endTimeModel" [timeOnly]="true" hourFormat="12" styleClass="p-inputtext-sm" [style]="{ minWidth: '7rem' }" /></td>
          <td><p-checkbox [(ngModel)]="a.isAvailable" [binary]="true" /></td>
          <td><p-button icon="pi pi-trash" severity="danger" [text]="true" [rounded]="true" (onClick)="removeSlot(rowIndex)" title="Remove" /></td>
        </tr>
      </ng-template>
    </p-table>
    <div class="mt-3">
      <p-button label="Save availability" icon="pi pi-check" (onClick)="save()" [loading]="saving" />
    </div>
  </p-card>
</div>
