<div class="teacher-group-classes page-container">
  <div class="page-header-compact">
    <div>
      <h1>Group classes</h1>
      <p class="page-desc-short">Edit name, Zoom link, and students. Two class types: One-To-One and Group. Admin creates and assigns Group classes to you.</p>
    </div>
  </div>

  <p-message *ngIf="error" severity="error" [text]="error" styleClass="w-full mb-3" />

  <p-card header="Your classes">
    <div *ngIf="loading" class="empty-table-message">
      <p-progressSpinner strokeWidth="4" styleClass="mb-2" [style]="{ width: '40px', height: '40px' }" />
      <span class="text-color-secondary">Loading...</span>
    </div>
    <div *ngIf="!loading && groupClasses.length === 0" class="empty-state">
      <i class="pi pi-book empty-icon"></i>
      <p>No group classes assigned to you.</p>
    </div>
    <div *ngIf="!loading && groupClasses.length > 0" class="class-list">
      <div *ngFor="let gc of groupClasses" class="class-card">
        <div class="class-info">
          <strong>{{ gc.name }}</strong>
          <p-tag [value]="gc.isActive ? 'Active' : 'Inactive'" [severity]="gc.isActive ? 'success' : 'secondary'" />
          <span class="enrolled">Enrolled: {{ gc.enrolledCount }}</span>
        </div>
        <div class="class-actions">
          <p-button label="Enrollments" icon="pi pi-users" [outlined]="true" size="small" (onClick)="viewEnrollments(gc)" />
        </div>
      </div>
    </div>
  </p-card>

  <p-dialog
    appendTo="body"
    [header]="selectedGroupClass.name + ' – Enrollments'"
    [visible]="!!selectedGroupClass"
    [modal]="true"
    [style]="{ width: '32rem' }"
    [draggable]="false"
    (onHide)="closeEnrollments()"
    *ngIf="selectedGroupClass">
    <div class="dialog-form">
      <div class="edit-section">
        <div class="field">
          <label>Name</label>
          <input pInputText type="text" [(ngModel)]="editName" class="w-full" />
        </div>
        <div class="field">
          <label>Zoom link</label>
          <input pInputText type="url" [(ngModel)]="editZoomUrl" class="w-full" placeholder="https://zoom.us/j/..." />
        </div>
        <div class="field flex align-items-center gap-2">
          <p-checkbox [(ngModel)]="editIsActive" [binary]="true" inputId="editIsActive" />
          <label for="editIsActive" class="checkbox-label">Active</label>
        </div>
        <p-button label="Save" icon="pi pi-check" (onClick)="updateGroupClass()" [loading]="updating" />
      </div>
      <h4 class="subheading">Students</h4>
      <div class="add-enroll-inline" *ngIf="assignableContracts.length > 0">
        <p-dropdown appendTo="body" [(ngModel)]="selectedEnrollContract" [options]="enrollContractOptions" optionLabel="label" optionValue="value" placeholder="Add student..." styleClass="inline-select" [style]="{ minWidth: '12rem' }" />
        <p-button label="Add" icon="pi pi-plus" (onClick)="enroll()" [loading]="enrolling" [disabled]="!selectedEnrollContract" />
      </div>
      <ul class="enrollment-list">
        <li *ngFor="let e of enrollments" class="enrollment-item">
          <span>{{ e.studentName }} – {{ e.contractIdDisplay }}</span>
          <p-button label="Remove" icon="pi pi-times" severity="danger" [outlined]="true" size="small" (onClick)="unenroll(e.id)" />
        </li>
        <li *ngIf="enrollments.length === 0" class="empty-enroll">No students yet.</li>
      </ul>
    </div>
    <ng-template pTemplate="footer">
      <p-button label="Done" (onClick)="closeEnrollments()" />
    </ng-template>
  </p-dialog>
</div>
